<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example Simulation • coiaf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example Simulation">
<meta property="og:description" content="coiaf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coiaf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sensitivity_analysis.html">Sensitivity Αnalysis</a>
    </li>
    <li>
      <a href="../articles/example_real_data.html">Real Data</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/example_coi_prediction.html">COI Prediction</a>
    </li>
    <li>
      <a href="../articles/example_simulation.html">Simulation Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ojwatson/coiaf/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_simulation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example Simulation</h1>
                        <h4 class="author">Aris Paschalidis</h4>
            
            <h4 class="date">July 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ojwatson/coiaf/blob/master/vignettes/example_simulation.Rmd"><code>vignettes/example_simulation.Rmd</code></a></small>
      <div class="hidden name"><code>example_simulation.Rmd</code></div>

    </div>

    
    
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h1>
<p>In this package, data are simulated using a simple statistical model: 1. Strain proportions are drawn from a symmetric Dirichlet distribution with shape parameter alpha.</p>
<ol style="list-style-type: decimal">
<li><p>Phased haplotypes are drawn at every locus, one for each COI. The allele at each locus is drawn from a Bernoulli distribution with probability given by the PLAF.</p></li>
<li><p>The “true” within-sample allele frequency at every locus is obtained by multiplying haplotypes by their strain proportions, and summing over haplotypes. Errors are introduced through the equation,</p></li>
</ol>
<p><span class="math display">\[wsaf_{error} = wsaf*(1-e) + (1-wsaf)*e\]</span> where <span class="math inline">\(wsaf\)</span> is the WSAF without error and <span class="math inline">\(e\)</span> is the error parameter epsilon.</p>
<ol style="list-style-type: decimal">
<li>Final read counts are drawn from a beta-binomial distribution with expectation <span class="math inline">\(w_{error}\)</span>. The raw number of draws is given by the coverage, and the skew of the distribution is given by the overdispersion parameter. If the overdispersion is equal to zero, then the distribution is binomial, rather than beta-binomial.</li>
</ol>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<p>The default values when a simulation is run are detailed in the table below.</p>
<table class="table">
<thead><tr class="header">
<th align="center">Parameter</th>
<th align="center">Default Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">COI</td>
<td align="center"><code>3</code></td>
</tr>
<tr class="even">
<td align="center">PLAF</td>
<td align="center"><code><a href="https://rdrr.io/r/stats/Uniform.html">runif(10, 0, 0.5)</a></code></td>
</tr>
<tr class="odd">
<td align="center">Coverage</td>
<td align="center"><code>100</code></td>
</tr>
<tr class="even">
<td align="center">Alpha</td>
<td align="center"><code>1</code></td>
</tr>
<tr class="odd">
<td align="center">Overdispersion</td>
<td align="center"><code>0</code></td>
</tr>
<tr class="even">
<td align="center">Epsilon</td>
<td align="center"><code>0</code></td>
</tr>
</tbody>
</table>
<p>The PLAF can be generated as follows</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># Set the seed</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)

<span class="co"># Define number of loci, and the distribution of the minor allele frequencies</span>
<span class="kw">L</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="kw">PLAF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span>(<span class="kw">L</span>, <span class="fl">1</span>, <span class="fl">5</span>)
<span class="kw">PLAF</span>[<span class="kw">PLAF</span> <span class="op">&gt;</span> <span class="fl">0.5</span>] <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="kw">PLAF</span>[<span class="kw">PLAF</span> <span class="op">&gt;</span> <span class="fl">0.5</span>]

<span class="kw">tbl_PLAF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw">PLAF</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">tbl_PLAF</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Locus"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">tbl_PLAF</span>, digits = <span class="fl">3</span>, align = <span class="st">"l"</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Locus 1</th>
<th align="left">Locus 2</th>
<th align="left">Locus 3</th>
<th align="left">Locus 4</th>
<th align="left">Locus 5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">0.356</td>
<td align="left">0.13</td>
<td align="left">0.012</td>
<td align="left">0.105</td>
<td align="left">0.435</td>
</tr></tbody>
</table>
<p>Strain proportions can be generated as follows</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">strain_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rdirichlet.html">rdirichlet</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">alpha</span>, <span class="kw">COI</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">strain_p</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Strain"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">strain_p</span>, digits = <span class="fl">3</span>, align = <span class="st">"l"</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Strain 1</td>
<td align="left">0.296</td>
</tr>
<tr class="even">
<td align="left">Strain 2</td>
<td align="left">0.379</td>
</tr>
<tr class="odd">
<td align="left">Strain 3</td>
<td align="left">0.324</td>
</tr>
</tbody>
</table>
<p>True WSAF can be found by</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">true_wsaf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="fu">function</span>(<span class="kw">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="kw">COI</span>, <span class="fl">1</span>, <span class="kw">x</span>), x = <span class="kw">PLAF</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="kw">true_wsaf</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Strain"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">true_wsaf</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Locus"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">true_wsaf</span>, digits = <span class="fl">3</span>, align = <span class="st">"l"</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">Locus 1</th>
<th align="left">Locus 2</th>
<th align="left">Locus 3</th>
<th align="left">Locus 4</th>
<th align="left">Locus 5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Strain 1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">Strain 2</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">Strain 3</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p>Simulated WSAF can be found by</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Coverage</span>
<span class="kw">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">PLAF</span>)
  <span class="co">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">coverage</span>) <span class="op">==</span> <span class="fl">1</span>) {
    <span class="kw">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">coverage</span>, <span class="kw">L</span>)
  }

<span class="kw">p_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span>(<span class="kw">true_wsaf</span>, <span class="fl">1</span>, <span class="kw">strain_p</span>, <span class="st">"*"</span>))

<span class="co"># Rounding errors from multiplying w by m can cause numbers greater than 1</span>
<span class="kw">p_levels</span>[<span class="kw">p_levels</span><span class="op">&gt;</span><span class="fl">1</span>] <span class="op">&lt;-</span> <span class="fl">1L</span>

<span class="co"># Add in genotyping error</span>
<span class="kw">p_error</span> <span class="op">&lt;-</span> <span class="kw">p_levels</span><span class="op">*</span>(<span class="fl">1</span><span class="op">-</span><span class="kw">epsilon</span>) <span class="op">+</span> (<span class="fl">1</span><span class="op">-</span><span class="kw">p_levels</span>)<span class="op">*</span><span class="kw">epsilon</span>

<span class="co"># Draw read counts, taking into account overdispersion</span>
<span class="co">if</span> (<span class="kw">overdispersion</span> <span class="op">==</span> <span class="fl">0</span>) {
  <span class="kw">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="kw">L</span>, size = <span class="kw">coverage</span>, prob = <span class="kw">p_error</span>)
}

<span class="kw">sim_wsaf</span> <span class="op">=</span> <span class="kw">counts</span><span class="op">/</span><span class="kw">coverage</span>

<span class="kw">tbl_sim_wsaf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw">sim_wsaf</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">tbl_sim_wsaf</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Locus"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">tbl_sim_wsaf</span>, digits = <span class="fl">3</span>, align = <span class="st">"l"</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Locus 1</th>
<th align="left">Locus 2</th>
<th align="left">Locus 3</th>
<th align="left">Locus 4</th>
<th align="left">Locus 5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">0.74</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0.29</td>
</tr></tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aris Paschalidis, OJ Watson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
